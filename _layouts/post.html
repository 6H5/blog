---
layout: default
---

{% assign post = page %}
{% if post.tags.size > 0 %}
  {% capture tags_content %}on {% endcapture %}
  {% for post_tag in post.tags %}
    {% assign tag = site.data.tags[post_tag] %}
    {% if tag %}
      {% capture tags_content_temp %}{{ tags_content }}<a href="{{ site.baseurl }}/tag/{{ post_tag }}/">{{ tag.name }}</a>{% if forloop.last == false %}<span>, </span>{% endif %}{% endcapture %}
      {% assign tags_content = tags_content_temp %}
    {% else %}
      {% assign tags_content = post.tags[0] %}
    {% endif %}
  {% endfor %}
{% else %}
  {% assign tags_content = '' %}
{% endif %}

<article class="post">
  <h1 class="post-title">{{ page.title }}</h1>
  <div class="post-date">
    <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
    <span>{{ tags_content }}</span>
  </div>
  {% if post.description %}
    {% comment %}
      Adding the "message" class to the last (and usually only) paragraph of the description.
    {% endcomment %}
    {% capture desc %}{{ post.description }}{:.message}{% endcapture %}
    {{ desc | markdownify }}
  {% endif %}
  <hr/>
  {{ content }}
</article>

{% if site.author.about %}
<aside class="related author">
  <h2 class="aside-title">关于作者</h2>

  {% if site.author.photo %}
  <img class="me rotate-infinite" src="{{ site.author.photo }}" alt="{{ site.author.name }}"/>
  {% endif %}

  {{ site.author.about | markdownify }}

  {% if site.author.weibo %}
  <wb:follow-button uid="3129142911" type="red_4" width="100%" height="64"></wb:follow-button>
  {% endif %}

</aside>
{% endif %}

<aside class="related articles">
  <h2 class="aside-title">相关文章</h2>
  {% assign plusone = false %}
  {% assign tag_name = page.tags[0] %}
  {% if site.tags[tag_name] and site.tags[tag_name].size >1 %}
  <ul class="related-posts">
    {% for post in site.tags[tag_name] limit:11 %}
      {% if post.url == page.url %}
        {% assign plusone = true %}
        {% continue %}
      {% endif %}
      {% if forloop.index < 10 or plusone == true %}
        <li>
          <h4>
            <a href="{{ post.url | prepend:site.baseurl }}">
              <span>{{ post.title }}</span>
              <small>{{ post.date | date: "%m/%d/%y" }}</small>
            </a>
          </h4>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
  {% else %}
  <p style="opacity: .5;padding: 5px;">博主太懒了，没有更多文章了</p>
  {% endif %}
</aside>

{% if site.author.disqus %}
<aside class="comments">
  <h2 class="aside-title">Comments</h2>

  <div id="disqus_thread"></div>

  <script>
    var disqus_config = function () {
      this.page.url = '{{ site.url }}{{ site.baseurl }}{{ post.url }}';
      this.page.identifier = '{{ post.id }}';
    };

    var loaded = false;
    var disqusThreadOffsetTop = document.getElementById('disqus_thread').offsetTop;

    window.addEventListener('scroll', function (e) {
      var bodyScrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      if (!loaded && bodyScrollTop + window.innerHeight >= disqusThreadOffsetTop) {
        loaded = true;
        var d = document, s = d.createElement('script');

        s.src = '//{{site.author.disqus}}.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      }
    });
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</aside>
{% endif %}

{% if site.attach.courses %}
<aside class="related attach-courses">
  <h2 class="aside-title">推荐课程</h2>
  <ul style="padding-left: 0;list-style: none;">
    {% for item in site.attach.courses %}
    <li>
      <h4>
        <a href="{{ item[1] }}" target="_blank">
          <span>{{ item[0] }}</span>
          <small style="font-size: 75%;color: #999;white-space: nowrap;">{{ item[2] }}</small>
        </a>
      </h4>
    </li>
    {% endfor %}
  </ul>
</aside>
{% endif %}

{% if site.attach.books %}
<aside class="related attach-books">
  <h2 class="aside-title">推荐书籍</h2>
  <div style="white-space: nowrap;overflow-x: auto;">
    {% for item in site.attach.books %}
    <a href="{{ item[1] }}" target="_blank" style="display: inline-block;width: 18%;min-width: 80px;margin: 0;">
      <img src="{{ item[2] }}">
    </a>
    {% endfor %}
  </div>
</aside>
{% endif %}


{% if site.blog_msg.host %}
<style type="text/css">
#blog_msg .submit-form {padding: 10px;border: 1px solid #ddd;font-size: 15px;}
#blog_msg .submit-form p input {width: 50%;height: 35px;margin: 0 5px 5px 0;padding: 4px;border: 1px solid #ddd;background-color: #fff;font-size: 14px;}
#blog_msg .submit-form p textarea {width: 70%;max-width: 100%;margin: 0 5px 5px 0;min-width: 50%;height: 100px;min-height: 70px;max-height: 200px;overflow: auto;padding: 4px;border: 1px solid #ddd;background-color: #fff;resize: none;vertical-align: middle;font-size: 14px;}
#blog_msg .submit-form p button {height: 40px;width: 120px;font-size: 15px;margin-bottom: 20px;cursor: pointer;border: 1px solid #ddd;background-color: rgb(236, 236, 236);}
#blog_msg .submit-form p span.star {color: #777;font-size: 13px;}
#blog_msg .submit-form p.red {color: red;font-size: 12px;margin-top: -15px;}
#blog_msg .list-one {padding: 10px;border: 1px solid #ddd;margin-bottom: 20px;font-size: 13px;}
</style>
<script src="https://s1.nianran.net/cdn/vue/2.6.10/vue.min.js"></script>
<script src="https://s1.nianran.net/cdn/axios/0.19.0/axios.min.js"></script>
<aside class="comments">
  <div id="blog_msg">
    <h2 class="aside-title" @click="replyTarget={}">评论列表
      <span style="font-size: 20px;">(<span v-html="list.length||0"></span>条)</span>
    </h2>
    <div v-for="(item,index) in list" class="list-one">
      <div style="position: relative;">
        <img class="jsAvatar" height="50" width="50" src="https://gravatar.loli.net/avatar/5fd26520ce413785c6445a57e3c79d8c?s=64" style="display: inline-block;vertical-align: middle;margin: 0;position: absolute;">
        <div style="display: inline-block;vertical-align: middle;left: 0;padding-left: 60px;width: 100%;">
          <p style="margin: 0;">
            <span v-html="item.name" style="font-weight: 600;text-decoration: underline;"></span>
            <span>评论:</span>
            <span v-html="item.created_at" style="color: #999;font-size: 12px;" class="float-right clearfix"></span>
          </p>
          <p style="margin: 0;color: #999;">
            <span v-html="item.content" style="color: #333;"></span> 
          </p>
          <div style="margin: 15px 0 5px 0;">
            <span style="margin-right: 15px;cursor: pointer;border: solid 1px #ddd;padding: 2px 5px;color: #34538b;" @click="zanIt(item)">赞
              <span v-html="item.zanIps || 0"></span>
            </span>
            <span style="cursor: pointer;border: solid 1px #ddd;padding: 2px 5px;color: #34538b;" @click="replyIt(item)">回复
              <span v-html="item.reply && item.reply.length || 0"></span>
            </span>
          </div>
          <div v-if="item.reply && replyTarget.id==item.id" style="margin-top: 20px;">
            <div v-for="(iten,indey) in item.reply" class="list-one">
              <img class="jsAvatar" height="50" width="50" src="https://gravatar.loli.net/avatar/5fd26520ce413785c6445a57e3c79d8c?s=64" style="display: inline-block;vertical-align: middle;margin: 0;position: absolute;">
              <div style="display: inline-block;vertical-align: middle;left: 0;padding-left: 60px;width: 100%;">
                <p style="margin: 0;">
                  <span v-html="iten.name" style="font-weight: 600;text-decoration: underline;"></span>
                  <span>回复:</span>
                  <span v-html="iten.created_at" style="color: #999;font-size: 12px;" class="float-right clearfix"></span>
                </p>
                <p style="margin: 0;color: #999;">
                  <span v-html="iten.content" style="color: #333;"></span> 
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div v-if="list.length==0" style="color: #333;">暂无评论</div>
    <div class="submit-form" style="margin-top: 20px;">
      <p v-if="replyTarget.id"> 
        <span>回复</span>
        <span v-html="replyTarget.name" style="font-weight: 600;text-decoration: underline;"></span>
        <span style="font-family: sans-serif;font-size: 20px;vertical-align: middle;">“</span>
        <span v-html="replyTarget.content" style="color: #333;max-width: 200px;display: inline-block;vertical-align: middle;" class="ellipsis"></span> 
        <span style="font-family: sans-serif;font-size: 20px;vertical-align: middle;">”</span>:
      </p>
      <p v-else style="color: #333;font-size: 18px;">发表评论</p>
      <p><input v-model="submitForm.name" maxlength="20" placeholder="名称"><span class="star">(必填)</span><span @click="getRandomName" style="padding: 2px 5px;display: inline-block;cursor: pointer;border: 1px solid #673AB7;background-color: #673AB7;margin-left: 10px;color: #fff;font-size: 14px;border-radius: 5px;">获取花名</span></p>
      <p v-if="vtips.name" v-html="vtips.name" class="red"></p>
      <p><input v-model="submitForm.email" maxlength="50" placeholder="邮箱地址(不会被公开)"><span class="star">(必填)</span></p>
      <p v-if="vtips.email" v-html="vtips.email" class="red"></p>
      <p><textarea v-model="submitForm.content" maxlength="140" placeholder="评论内容(140字以内)"></textarea><span class="star">(必填)</span></p>
      <p v-if="vtips.content" v-html="vtips.content" class="red"></p>
      <p><button @click="submitMsg">提交</button></p>
    </div>
  </div>
  <script type="text/javascript">
    var regExp = {
      email: /^([a-zA-Z0-9]+[-_\.]?)+@[a-zA-Z0-9]+\.[a-z]+$/
    }
    // 验证邮箱格式
    var checkEmail = function(str) {
      return regExp.email.test(str)
    }
    var host = '{{site.blog_msg.host}}'
    var path = '{{post.url}}'
    // path = encodeURIComponent(path)
    // console.log(host,path)
    var vm = new Vue({
      el: '#blog_msg',
      data: {
        list: [],
        submitForm: {name: '',email: '',content: '',path,},
        vtips: {name: '',email: '',content: ''},
        replyTarget: {}
      },
      created: function () {
        var f = JSON.parse(window.localStorage.getItem('blogMsg.submitForm') || '{}')
        this.submitForm.name = f.name
        this.submitForm.email = f.email
      },
      mounted: function(){
        this.getList()
        if(!this.submitForm.name){
          this.getRandomName()
        }
      },
      methods: {
        getList: function(){
          var _this = this
          axios.get(host+'blogMsg/list?path='+path).then(function (res) {
            // console.log(res);
            if(res.data.code == 200){
              _this.list = res.data.result || []
            }
          }).catch(function (error) {
            console.log(error);
          });
        },
        replyIt:function(item){
          if(this.replyTarget.id){
            this.replyTarget = {}
          }else{
            this.replyTarget = item
          }
        },
        zanIt:function(item){
          if(item.id){
            var _this = this
            axios.post(host+'/blogMsg/zan/'+item.id).then(function (res) {
              // console.log(res);
              if(res.data.code == 200){
                _this.getList()
              }else{
                alert(res.data.msg)
              }
            }).catch(function (error) {
              console.log(error);
              alert(error)
            });
          }
        },
        getRandomName: function(){
          var _this = this
          axios.get(host+'blogMsg/randomName').then(function (res) {
            // console.log(res);
            if(res.data.code == 200 && res.data.result){
              _this.submitForm.name = res.data.result   
            }else{
              alert('获取花名服务异常')
            }
          }).catch(function (error) {
            console.log(error);
          });
        },
        submitMsg: function() {
          var f = this.submitForm
          console.log(f)
          this.vtips = {name: '',email: '',content: ''}
          if(!f.name){this.vtips.name='请填写名称';return;}
          if(!f.email){this.vtips.email='请填写邮箱地址';return;}
          if(!checkEmail(f.email)){this.vtips.email='邮箱地址格式不正确';return;}
          if(!f.content){this.vtips.content='请填写评论内容';return;}
          window.localStorage.setItem('blogMsg.submitForm',JSON.stringify(f))
          const msgId = this.replyTarget.id || ''
          var _this = this
          if(msgId){
            axios.post(host+'/blogMsg/reply/'+msgId,f).then(function (res) {
              console.log(res);
              if(res.data.code == 200){
                alert('您的回复已经提交成功')
                _this.submitForm.content = ''
                _this.getList()
              }else{
                alert(res.data.msg)
              }
            }).catch(function (error) {
              console.log(error);
              alert(error)
            });
          }else{
            axios.post(host+'/blogMsg/create',f).then(function (res) {
              console.log(res);
              if(res.data.code == 200){
                alert('您的评论已经提交成功')
                _this.submitForm.content = ''
                _this.getList()
              }else{
                alert(res.data.msg)
              }
            }).catch(function (error) {
              console.log(error);
              alert(error)
            });
          }
        }
      }
    })
  </script>
</aside>
{% endif %}

